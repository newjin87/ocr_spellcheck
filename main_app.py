"""
main_app.py
----------------------------------
Streamlit í†µí•© ì‹¤í–‰ íŒŒì¼

í”„ë¡œì„¸ìŠ¤:
1. PDF ì—…ë¡œë“œ
2. Vision OCR â†’ í…ìŠ¤íŠ¸ ì¶”ì¶œ
3. Gemini êµì • â†’ êµì • ê²°ê³¼ ì¶œë ¥
----------------------------------
"""

import streamlit as st
# âœ… í•„ìˆ˜ ìˆ˜ì • ì‚¬í•­: src í´ë”ì—ì„œ ëª¨ë“ˆì„ ê°€ì ¸ì˜¤ë„ë¡ ê²½ë¡œ ìˆ˜ì •
from src.vision_ocr import run_ocr_pipeline
from src.spell_corrector import correct_text

# -------------------------------------------------------
# ğŸ¨ UI ê¸°ë³¸ ì„¤ì •
# -------------------------------------------------------
st.set_page_config(page_title="AI OCR + ë§ì¶¤ë²• êµì •ê¸°", page_icon="ğŸ§ ", layout="wide")
st.title("ğŸ§¾ AI OCR + ë§ì¶¤ë²• êµì •ê¸° (Google Vision + Gemini)")

st.markdown("""
ì´ ì•±ì€ PDFì—ì„œ ë¬¸ì„œë¥¼ ìë™ìœ¼ë¡œ ì½ê³   
Google Geminië¥¼ ì‚¬ìš©í•´ **ë§ì¶¤ë²• êµì • / ë¬¸ì¥ ë‹¤ë“¬ê¸° / ìš”ì•½ / ë²ˆì—­**ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. âœ¨
""")

# -------------------------------------------------------
# ğŸ“‚ íŒŒì¼ ì—…ë¡œë“œ
# -------------------------------------------------------
uploaded_file = st.file_uploader("ğŸ“¤ PDF íŒŒì¼ ì—…ë¡œë“œ", type=["pdf"])

# -------------------------------------------------------
# ğŸ§¾ OCR ì‹¤í–‰ ë° ê²°ê³¼ í‘œì‹œ
# -------------------------------------------------------
if uploaded_file:
    st.info("ğŸ“˜ PDF ì—…ë¡œë“œ ì™„ë£Œ â€” OCRì„ ì‹œì‘í•©ë‹ˆë‹¤...")
    extracted_text = run_ocr_pipeline(uploaded_file)

    if extracted_text:
        st.success("âœ… OCR ì™„ë£Œ! ì¶”ì¶œëœ í…ìŠ¤íŠ¸ê°€ ì•„ë˜ì— í‘œì‹œë©ë‹ˆë‹¤.")
        st.text_area("ğŸ“œ OCR ê²°ê³¼", extracted_text, height=250)

        # -------------------------------------------------------
        # âœï¸ Gemini êµì • ë‹¨ê³„
        # -------------------------------------------------------
        st.subheader("âœï¸ Gemini ë§ì¶¤ë²• ë° ë¬¸ì¥ êµì •")

        mode = st.selectbox(
            "ì›í•˜ëŠ” êµì • ëª¨ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”:",
            ["ë§ì¶¤ë²• êµì •", "ë¬¸ì¥ ìì—°ìŠ¤ëŸ½ê²Œ ë‹¤ë“¬ê¸°", "ìš”ì•½í•˜ê¸°", "ì˜ì–´ ë²ˆì—­"]
        )

        if st.button("ğŸš€ êµì • ì‹¤í–‰"):
            with st.spinner("Geminiê°€ êµì • ì¤‘ì…ë‹ˆë‹¤... â³"):
                result = correct_text(extracted_text, mode)
                st.success("âœ… êµì • ì™„ë£Œ!")
                
                # ğŸ’¬ êµì • ê²°ê³¼ í‘œì‹œ (í…ìŠ¤íŠ¸ ì˜ì—­)
                st.text_area("ğŸ’¬ êµì • ê²°ê³¼", result, height=250)
                
                # ë³µì‚¬ ë²„íŠ¼ ê¸°ëŠ¥: st.codeì˜ Copy ë²„íŠ¼ í™œìš©
                st.code(result, language="text", line_numbers=False)
                st.markdown("ğŸ‘† ìœ„ì˜ ì½”ë“œ ë¸”ë¡ ì˜¤ë¥¸ìª½ì— ìˆëŠ” **Copy** ë²„íŠ¼ì„ ì‚¬ìš©í•˜ì—¬ êµì • ê²°ê³¼ë¥¼ ë³µì‚¬í•˜ì„¸ìš”.")

    else:
        st.error("âŒ OCRì—ì„œ í…ìŠ¤íŠ¸ë¥¼ ì¶”ì¶œí•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.")

# -------------------------------------------------------
# ğŸ§© Footer
# -------------------------------------------------------
st.markdown("---")
st.caption("Made with â¤ï¸ by ìœ ì„±ì§„ | Vision API + Gemini í†µí•© ë²„ì „")